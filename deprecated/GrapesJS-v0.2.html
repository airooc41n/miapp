<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GripesJS Studio Pro - Diseño Drag & Drop Avanzado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5c6bc0;
            --primary-dark: #3f4f9e;
            --primary-light: #8e99f3;
            --secondary: #26a69a;
            --success: #66bb6a;
            --warning: #ffa726;
            --danger: #ef5350;
            --info: #29b6f6;
            --dark: #263238;
            --light: #f5f7fa;
            --gray: #90a4ae;
            --border: #cfd8dc;
            --sidebar-bg: #2c3e50;
            --code-bg: #1e1e1e;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --radius: 8px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 15px;
            overflow: hidden;
        }

        .app-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 25px 75px rgba(0,0,0,0.3);
            overflow: hidden;
            height: 96vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--dark);
            color: white;
            padding: 0 25px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-light);
        }

        .logo i {
            font-size: 1.8rem;
            color: var(--info);
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #4caf50;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #e53935;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #fb8c00;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #0288d1;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-light {
            background: var(--light);
            color: var(--dark);
            border: 1px solid var(--border);
        }

        .btn-light:hover {
            background: #e3f2fd;
            transform: translateY(-1px);
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar Left - Components */
        .sidebar-left {
            width: 320px;
            background: var(--light);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .components-search {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .search-box {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(92, 107, 192, 0.2);
        }

        .components-categories {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .category {
            margin-bottom: 25px;
        }

        .category-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-title i {
            color: var(--primary);
        }

        .components-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .component-item {
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px 10px;
            text-align: center;
            cursor: grab;
            transition: var(--transition);
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .component-item:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .component-item i {
            font-size: 1.6rem;
            color: var(--primary);
        }

        .component-item span {
            font-size: 0.85rem;
            color: var(--dark);
            font-weight: 500;
        }

        .component-tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 4px;
        }

        .tag {
            font-size: 0.7rem;
            padding: 2px 6px;
            background: var(--light);
            border-radius: 4px;
            color: var(--gray);
        }

        /* Design Area */
        .design-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #f8fafc;
        }

        .design-toolbar {
            padding: 15px 25px;
            background: white;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .toolbar-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .toolbar-label {
            font-size: 0.9rem;
            color: var(--dark);
            font-weight: 500;
        }

        .toolbar-select {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
            cursor: pointer;
        }

        .toolbar-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .design-area-wrapper {
            flex: 1;
            padding: 25px;
            overflow: auto;
            position: relative;
        }

        .design-area {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            min-height: 600px;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            transition: width 0.3s ease;
        }

        .design-area.drag-over {
            border: 2px dashed var(--primary);
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
            opacity: 0.5;
        }

        .placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--gray);
            padding: 40px;
            max-width: 400px;
        }

        .placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .placeholder h3 {
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
        }

        /* Dropped Components */
        .dropped-component {
            position: absolute;
            border: 2px solid transparent;
            border-radius: 6px;
            transition: var(--transition);
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            cursor: move;
            min-width: 100px;
            min-height: 50px;
            resize: both;
            overflow: auto;
            max-width: 100%;
            max-height: 100%;
        }

        .dropped-component:hover {
            border-color: var(--primary-light);
            box-shadow: 0 5px 20px rgba(0,0,0,0.12);
        }

        .dropped-component.selected {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(92, 107, 192, 0.2);
            z-index: 100;
        }

        .component-header {
            background: var(--primary);
            color: white;
            padding: 8px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 4px 4px 0 0;
            cursor: move;
        }

        .component-controls {
            display: flex;
            gap: 5px;
        }

        .component-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .component-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .component-content {
            padding: 15px;
        }

        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--primary);
            border-radius: 50%;
            bottom: -5px;
            right: -5px;
            cursor: nwse-resize;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .dropped-component:hover .resize-handle {
            opacity: 1;
        }

        /* Sidebar Right - Properties & Code */
        .sidebar-right {
            width: 380px;
            background: white;
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--border);
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: rgba(0,0,0,0.02);
            color: var(--dark);
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            flex: 1;
            overflow: hidden;
            display: none;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        /* Properties Panel */
        .properties-panel {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .properties-group {
            margin-bottom: 25px;
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid var(--primary);
        }

        .group-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .property {
            margin-bottom: 15px;
        }

        .property label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--dark);
        }

        .property-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .property-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(92, 107, 192, 0.2);
        }

        .property-row {
            display: flex;
            gap: 10px;
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 1px solid var(--border);
            cursor: pointer;
        }

        .range-value {
            font-size: 0.85rem;
            color: var(--gray);
            margin-left: 10px;
        }

        /* Code Editor */
        .code-panel {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .code-header {
            padding: 15px 20px;
            background: var(--code-bg);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }

        .code-options {
            display: flex;
            gap: 10px;
        }

        .code-editor-container {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .code-editor {
            width: 100%;
            height: 100%;
            background: var(--code-bg);
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            padding: 20px;
            border: none;
            resize: none;
            outline: none;
            tab-size: 2;
        }

        .code-lines {
            position: absolute;
            left: 0;
            top: 0;
            width: 50px;
            height: 100%;
            background: #1e1e1e;
            color: #858585;
            text-align: right;
            padding: 20px 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow: hidden;
            user-select: none;
            border-right: 1px solid #333;
        }

        /* Layers Panel */
        .layers-panel {
            padding: 20px;
            overflow-y: auto;
        }

        .layers-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .layer-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 15px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }

        .layer-item:hover {
            background: var(--light);
            border-color: var(--primary-light);
        }

        .layer-item.selected {
            background: rgba(92, 107, 192, 0.1);
            border-color: var(--primary);
        }

        .layer-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .layer-info {
            flex: 1;
        }

        .layer-name {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--dark);
        }

        .layer-type {
            font-size: 0.75rem;
            color: var(--gray);
        }

        .layer-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .layer-item:hover .layer-actions {
            opacity: 1;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 30px 80px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: var(--dark);
            color: white;
            padding: 20px 25px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 20px 25px;
            background: var(--light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            border-top: 1px solid var(--border);
        }

        /* Export Options */
        .export-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .export-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 25px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .export-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .export-card i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .export-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
        }

        .export-card p {
            font-size: 0.85rem;
            color: var(--gray);
            line-height: 1.4;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(100%);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            max-width: 350px;
            border-left: 4px solid var(--primary);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.success i {
            color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.error i {
            color: var(--danger);
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .sidebar-left, .sidebar-right {
                width: 300px;
            }
        }

        @media (max-width: 1200px) {
            .sidebar-left {
                width: 280px;
            }
            .sidebar-right {
                width: 350px;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                flex-direction: column;
            }
            .sidebar-left, .sidebar-right {
                width: 100%;
                height: auto;
                max-height: 300px;
            }
            .sidebar-left {
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
            .sidebar-right {
                border-left: none;
                border-top: 1px solid var(--border);
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-cube"></i>
                <span>GripesJS Studio Pro</span>
            </div>
            <div class="controls">
                <button class="btn btn-light" id="saveBtn" title="Guardar proyecto">
                    <i class="fas fa-save"></i> Guardar
                </button>
                <button class="btn btn-light" id="loadBtn" title="Cargar proyecto">
                    <i class="fas fa-folder-open"></i> Cargar
                </button>
                <div class="toolbar-group">
                    <label class="toolbar-label">Zoom:</label>
                    <select class="toolbar-select" id="zoomSelect">
                        <option value="0.5">50%</option>
                        <option value="0.75">75%</option>
                        <option value="1" selected>100%</option>
                        <option value="1.25">125%</option>
                        <option value="1.5">150%</option>
                    </select>
                </div>
                <button class="btn btn-danger" id="clearBtn" title="Limpiar todo">
                    <i class="fas fa-trash-alt"></i> Limpiar
                </button>
                <button class="btn btn-success" id="exportBtn" title="Exportar diseño">
                    <i class="fas fa-file-export"></i> Exportar
                </button>
                <button class="btn btn-primary" id="previewBtn" title="Vista previa">
                    <i class="fas fa-eye"></i> Vista Previa
                </button>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Sidebar - Components -->
            <div class="sidebar-left">
                <div class="components-search">
                    <input type="text" class="search-box" id="searchBox" placeholder="Buscar componentes...">
                </div>
                <div class="components-categories" id="componentsContainer">
                    <!-- Categorías y componentes se cargan dinámicamente -->
                </div>
            </div>

            <!-- Main Design Area -->
            <div class="design-container">
                <div class="design-toolbar">
                    <div class="toolbar-group">
                        <label class="toolbar-label">Tamaño:</label>
                        <select class="toolbar-select" id="sizeSelect">
                            <option value="desktop">Desktop (1200px)</option>
                            <option value="tablet">Tablet (768px)</option>
                            <option value="mobile">Mobile (375px)</option>
                            <option value="full">Full Width</option>
                        </select>
                    </div>
                    <div class="toolbar-group">
                        <label class="toolbar-label">Guías:</label>
                        <select class="toolbar-select" id="gridSelect">
                            <option value="10">10px</option>
                            <option value="20" selected>20px</option>
                            <option value="50">50px</option>
                            <option value="100">100px</option>
                            <option value="0">Off</option>
                        </select>
                    </div>
                    <div class="toolbar-group">
                        <button class="btn btn-light" id="undoBtn" title="Deshacer">
                            <i class="fas fa-undo"></i>
                        </button>
                        <button class="btn btn-light" id="redoBtn" title="Rehacer">
                            <i class="fas fa-redo"></i>
                        </button>
                        <button class="btn btn-light" id="alignLeftBtn" title="Alinear a la izquierda">
                            <i class="fas fa-align-left"></i>
                        </button>
                        <button class="btn btn-light" id="alignCenterBtn" title="Centrar">
                            <i class="fas fa-align-center"></i>
                        </button>
                        <button class="btn btn-light" id="alignRightBtn" title="Alinear a la derecha">
                            <i class="fas fa-align-right"></i>
                        </button>
                        <button class="btn btn-light" id="snapToggle" title="Activar/desactivar snapping">
                            <i class="fas fa-magnet"></i>
                        </button>
                    </div>
                </div>
                <div class="design-area-wrapper">
                    <div class="design-area" id="designArea">
                        <div class="grid-overlay" id="gridOverlay"></div>
                        <div class="placeholder" id="placeholder">
                            <i class="fas fa-shapes"></i>
                            <h3>Área de Diseño</h3>
                            <p>Arrastra componentes desde el panel izquierdo o haz clic derecho para añadir elementos</p>
                            <p style="font-size: 0.9rem; margin-top: 15px;">
                                <i class="fas fa-lightbulb"></i> Consejo: Usa Ctrl+Z para deshacer y Ctrl+Y para rehacer
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar - Properties & Code -->
            <div class="sidebar-right">
                <div class="sidebar-tabs">
                    <button class="tab-btn active" data-tab="properties">
                        <i class="fas fa-sliders-h"></i> Propiedades
                    </button>
                    <button class="tab-btn" data-tab="layers">
                        <i class="fas fa-layer-group"></i> Capas
                    </button>
                    <button class="tab-btn" data-tab="code">
                        <i class="fas fa-code"></i> Código
                    </button>
                </div>

                <!-- Properties Tab -->
                <div class="tab-content active" id="propertiesTab">
                    <div class="properties-panel" id="propertiesPanel">
                        <div class="placeholder" style="position: relative; transform: none; padding: 40px 20px;">
                            <i class="fas fa-mouse-pointer"></i>
                            <h3>Selecciona un componente</h3>
                            <p>Haz clic en cualquier componente del área de diseño para editar sus propiedades</p>
                        </div>
                    </div>
                </div>

                <!-- Layers Tab -->
                <div class="tab-content" id="layersTab">
                    <div class="layers-panel">
                        <div class="layers-list" id="layersList">
                            <!-- Las capas se cargan dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Code Tab -->
                <div class="tab-content" id="codeTab">
                    <div class="code-panel">
                        <div class="code-header">
                            <span>Editor de Código</span>
                            <div class="code-options">
                                <button class="btn btn-primary" id="copyCodeBtn" style="padding: 5px 10px; font-size: 0.8rem;">
                                    <i class="fas fa-copy"></i> Copiar
                                </button>
                                <button class="btn btn-success" id="updateCodeBtn" style="padding: 5px 10px; font-size: 0.8rem;">
                                    <i class="fas fa-sync"></i> Actualizar
                                </button>
                            </div>
                        </div>
                        <div class="code-editor-container">
                            <div class="code-lines" id="codeLines">1</div>
                            <textarea class="code-editor" id="codeEditor" spellcheck="false"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>Exportar Diseño</span>
                <button class="modal-close" id="closeExportModal">&times;</button>
            </div>
            <div class="modal-body">
                <h3 style="margin-bottom: 20px; color: var(--dark);">Selecciona el formato de exportación:</h3>
                <div class="export-grid" id="exportGrid">
                    <!-- Las opciones de exportación se cargan dinámicamente -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" id="cancelExportBtn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="projectModalTitle">Gestionar Proyectos</span>
                <button class="modal-close" id="closeProjectModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="projectModalContent">
                    <!-- Contenido dinámico para guardar/cargar proyectos -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" id="cancelProjectBtn">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ================================
        // GRIPESJS CORE LIBRARY
        // ================================
        class GripesJS {
            constructor() {
                this.components = [];
                this.selectedComponent = null;
                this.history = [];
                this.historyIndex = -1;
                this.nextId = 1;
                this.snapGrid = 20;
                this.snapEnabled = true;
                this.currentPageSize = 'desktop';
                
                // Definir componentes disponibles
                this.availableComponents = this.defineComponents();
                
                this.init();
            }

            defineComponents() {
                return {
                    // Componentes Básicos
                    'header': {
                        name: 'Encabezado',
                        category: 'Básicos',
                        icon: 'fas fa-heading',
                        tags: ['texto', 'titulo'],
                        defaultConfig: {
                            text: 'Encabezado Principal',
                            level: 'h1',
                            color: '#333333',
                            align: 'left',
                            size: '2.5rem',
                            margin: '0 0 20px 0'
                        }
                    },
                    'paragraph': {
                        name: 'Párrafo',
                        category: 'Básicos',
                        icon: 'fas fa-paragraph',
                        tags: ['texto', 'contenido'],
                        defaultConfig: {
                            text: 'Este es un párrafo de ejemplo. Puedes editar este texto para añadir tu contenido personalizado.',
                            color: '#666666',
                            align: 'left',
                            size: '1rem',
                            lineHeight: '1.6'
                        }
                    },
                    'button': {
                        name: 'Botón',
                        category: 'Básicos',
                        icon: 'fas fa-square',
                        tags: ['click', 'acción'],
                        defaultConfig: {
                            text: 'Haz clic aquí',
                            color: '#5c6bc0',
                            backgroundColor: '#5c6bc0',
                            hoverColor: '#3f4f9e',
                            size: 'medium',
                            borderRadius: '6px',
                            padding: '12px 24px'
                        }
                    },
                    'image': {
                        name: 'Imagen',
                        category: 'Básicos',
                        icon: 'fas fa-image',
                        tags: ['media', 'visual'],
                        defaultConfig: {
                            src: 'https://via.placeholder.com/400x300',
                            alt: 'Imagen de ejemplo',
                            width: '100%',
                            height: 'auto',
                            borderRadius: '8px'
                        }
                    },
                    'divider': {
                        name: 'Divisor',
                        category: 'Básicos',
                        icon: 'fas fa-minus',
                        tags: ['separador', 'línea'],
                        defaultConfig: {
                            color: '#e0e0e0',
                            thickness: '1px',
                            style: 'solid',
                            margin: '20px 0'
                        }
                    },

                    // Componentes de Formulario
                    'input': {
                        name: 'Campo de Texto',
                        category: 'Formularios',
                        icon: 'fas fa-font',
                        tags: ['form', 'entrada'],
                        defaultConfig: {
                            placeholder: 'Escribe aquí...',
                            type: 'text',
                            width: '100%',
                            padding: '10px 15px',
                            borderRadius: '6px',
                            borderColor: '#cfd8dc'
                        }
                    },
                    'textarea': {
                        name: 'Área de Texto',
                        category: 'Formularios',
                        icon: 'fas fa-align-left',
                        tags: ['form', 'texto'],
                        defaultConfig: {
                            placeholder: 'Escribe tu mensaje aquí...',
                            rows: 4,
                            width: '100%',
                            padding: '10px 15px',
                            borderRadius: '6px',
                            borderColor: '#cfd8dc'
                        }
                    },
                    'select': {
                        name: 'Lista Desplegable',
                        category: 'Formularios',
                        icon: 'fas fa-caret-down',
                        tags: ['form', 'opciones'],
                        defaultConfig: {
                            options: ['Opción 1', 'Opción 2', 'Opción 3'],
                            width: '100%',
                            padding: '10px 15px',
                            borderRadius: '6px',
                            borderColor: '#cfd8dc'
                        }
                    },
                    'checkbox': {
                        name: 'Casilla',
                        category: 'Formularios',
                        icon: 'fas fa-check-square',
                        tags: ['form', 'selección'],
                        defaultConfig: {
                            label: 'Acepto los términos y condiciones',
                            checked: false
                        }
                    },
                    'radio': {
                        name: 'Botón Radio',
                        category: 'Formularios',
                        icon: 'fas fa-dot-circle',
                        tags: ['form', 'selección'],
                        defaultConfig: {
                            label: 'Opción seleccionada',
                            checked: false,
                            group: 'radio-group'
                        }
                    },

                    // Componentes de Layout
                    'container': {
                        name: 'Contenedor',
                        category: 'Layout',
                        icon: 'fas fa-square-full',
                        tags: ['layout', 'contenedor'],
                        defaultConfig: {
                            width: '100%',
                            padding: '20px',
                            backgroundColor: '#ffffff',
                            borderRadius: '8px',
                            border: '1px solid #e0e0e0'
                        }
                    },
                    'row': {
                        name: 'Fila',
                        category: 'Layout',
                        icon: 'fas fa-columns',
                        tags: ['layout', 'grid'],
                        defaultConfig: {
                            columns: 12,
                            gap: '20px',
                            padding: '0',
                            flexWrap: 'wrap'
                        }
                    },
                    'column': {
                        name: 'Columna',
                        category: 'Layout',
                        icon: 'fas fa-columns',
                        tags: ['layout', 'grid'],
                        defaultConfig: {
                            width: '50%',
                            padding: '10px',
                            backgroundColor: 'transparent'
                        }
                    },
                    'card': {
                        name: 'Tarjeta',
                        category: 'Layout',
                        icon: 'fas fa-id-card',
                        tags: ['layout', 'contenido'],
                        defaultConfig: {
                            title: 'Título de la Tarjeta',
                            content: 'Contenido de la tarjeta. Puedes personalizar este texto.',
                            image: 'https://via.placeholder.com/300x200',
                            padding: '20px',
                            borderRadius: '12px',
                            backgroundColor: '#ffffff',
                            boxShadow: '0 4px 20px rgba(0,0,0,0.08)'
                        }
                    },

                    // Componentes de Navegación
                    'navbar': {
                        name: 'Barra de Navegación',
                        category: 'Navegación',
                        icon: 'fas fa-bars',
                        tags: ['menu', 'navegación'],
                        defaultConfig: {
                            logo: 'Logo',
                            menuItems: ['Inicio', 'Servicios', 'Contacto'],
                            backgroundColor: '#2c3e50',
                            textColor: '#ffffff',
                            padding: '15px 30px'
                        }
                    },
                    'menu': {
                        name: 'Menú',
                        category: 'Navegación',
                        icon: 'fas fa-list',
                        tags: ['navegación', 'lista'],
                        defaultConfig: {
                            items: ['Inicio', 'Acerca de', 'Servicios', 'Contacto'],
                            direction: 'horizontal',
                            gap: '20px'
                        }
                    },
                    'breadcrumb': {
                        name: 'Migas de Pan',
                        category: 'Navegación',
                        icon: 'fas fa-angle-double-right',
                        tags: ['navegación', 'ruta'],
                        defaultConfig: {
                            items: ['Inicio', 'Categoría', 'Subcategoría', 'Página Actual'],
                            separator: '/'
                        }
                    },

                    // Componentes Especiales
                    'accordion': {
                        name: 'Acordeón',
                        category: 'Especiales',
                        icon: 'fas fa-chevron-down',
                        tags: ['colapsable', 'faq'],
                        defaultConfig: {
                            items: [
                                { title: 'Sección 1', content: 'Contenido de la sección 1' },
                                { title: 'Sección 2', content: 'Contenido de la sección 2' }
                            ],
                            openFirst: true
                        }
                    },
                    'tabs': {
                        name: 'Pestañas',
                        category: 'Especiales',
                        icon: 'fas fa-folder',
                        tags: ['navegación', 'contenido'],
                        defaultConfig: {
                            tabs: ['Pestaña 1', 'Pestaña 2', 'Pestaña 3'],
                            activeTab: 0,
                            content: [
                                'Contenido de la pestaña 1',
                                'Contenido de la pestaña 2',
                                'Contenido de la pestaña 3'
                            ]
                        }
                    },
                    'modal': {
                        name: 'Modal',
                        category: 'Especiales',
                        icon: 'fas fa-window-maximize',
                        tags: ['popup', 'diálogo'],
                        defaultConfig: {
                            title: 'Título del Modal',
                            content: 'Contenido del modal. Puedes añadir cualquier elemento aquí.',
                            buttonText: 'Abrir Modal',
                            width: '500px'
                        }
                    },
                    'carousel': {
                        name: 'Carrusel',
                        category: 'Especiales',
                        icon: 'fas fa-images',
                        tags: ['slider', 'galería'],
                        defaultConfig: {
                            images: [
                                'https://via.placeholder.com/800x400/5c6bc0/ffffff?text=Slide+1',
                                'https://via.placeholder.com/800x400/26a69a/ffffff?text=Slide+2',
                                'https://via.placeholder.com/800x400/ffa726/ffffff?text=Slide+3'
                            ],
                            autoplay: true,
                            interval: 3000
                        }
                    },

                    // Componentes de Media
                    'video': {
                        name: 'Video',
                        category: 'Media',
                        icon: 'fas fa-video',
                        tags: ['media', 'player'],
                        defaultConfig: {
                            src: 'https://www.w3schools.com/html/mov_bbb.mp4',
                            width: '100%',
                            height: 'auto',
                            controls: true,
                            autoplay: false
                        }
                    },
                    'audio': {
                        name: 'Audio',
                        category: 'Media',
                        icon: 'fas fa-music',
                        tags: ['media', 'sonido'],
                        defaultConfig: {
                            src: 'https://www.w3schools.com/html/horse.mp3',
                            controls: true,
                            autoplay: false
                        }
                    },
                    'icon': {
                        name: 'Icono',
                        category: 'Media',
                        icon: 'fas fa-icons',
                        tags: ['icono', 'símbolo'],
                        defaultConfig: {
                            icon: 'fas fa-star',
                            size: '24px',
                            color: '#5c6bc0'
                        }
                    },

                    // Componentes de Datos
                    'table': {
                        name: 'Tabla',
                        category: 'Datos',
                        icon: 'fas fa-table',
                        tags: ['datos', 'grid'],
                        defaultConfig: {
                            headers: ['Nombre', 'Edad', 'Ciudad'],
                            rows: [
                                ['Juan Pérez', '28', 'Madrid'],
                                ['María Gómez', '32', 'Barcelona'],
                                ['Carlos Ruiz', '45', 'Valencia']
                            ],
                            striped: true,
                            hover: true
                        }
                    },
                    'progress': {
                        name: 'Barra de Progreso',
                        category: 'Datos',
                        icon: 'fas fa-spinner',
                        tags: ['progreso', 'estado'],
                        defaultConfig: {
                            value: 65,
                            max: 100,
                            color: '#5c6bc0',
                            height: '20px',
                            showPercentage: true
                        }
                    },
                    'badge': {
                        name: 'Badge',
                        category: 'Datos',
                        icon: 'fas fa-certificate',
                        tags: ['etiqueta', 'indicador'],
                        defaultConfig: {
                            text: 'Nuevo',
                            color: '#ef5350',
                            backgroundColor: '#ffebee',
                            borderRadius: '12px',
                            padding: '4px 12px'
                        }
                    },

                    // Componentes Avanzados
                    'map': {
                        name: 'Mapa',
                        category: 'Avanzados',
                        icon: 'fas fa-map',
                        tags: ['ubicación', 'geo'],
                        defaultConfig: {
                            latitude: 40.4168,
                            longitude: -3.7038,
                            zoom: 12,
                            width: '100%',
                            height: '300px'
                        }
                    },
                    'chart': {
                        name: 'Gráfico',
                        category: 'Avanzados',
                        icon: 'fas fa-chart-bar',
                        tags: ['datos', 'visualización'],
                        defaultConfig: {
                            type: 'bar',
                            data: {
                                labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May'],
                                datasets: [{
                                    label: 'Ventas',
                                    data: [12, 19, 3, 5, 2],
                                    backgroundColor: '#5c6bc0'
                                }]
                            },
                            width: '100%',
                            height: '300px'
                        }
                    }
                };
            }

            init() {
                this.setupEventListeners();
                this.renderComponentPanel();
                this.setupExportOptions();
                this.updateGrid();
                this.saveHistory();
            }

            setupEventListeners() {
                // Eventos del área de diseño
                const designArea = document.getElementById('designArea');
                
                designArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    designArea.classList.add('drag-over');
                });

                designArea.addEventListener('dragleave', () => {
                    designArea.classList.remove('drag-over');
                });

                designArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    designArea.classList.remove('drag-over');
                    
                    const type = e.dataTransfer.getData('component-type');
                    if (type) {
                        const rect = designArea.getBoundingClientRect();
                        const x = e.clientX - rect.left - 50;
                        const y = e.clientY - rect.top - 50;
                        
                        this.createComponent(type, {
                            position: { x: this.snapToGrid(x), y: this.snapToGrid(y) }
                        });
                    }
                });

                // Context menu para añadir componentes rápidamente
                designArea.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.showContextMenu(e);
                });

                // Click fuera para deseleccionar
                designArea.addEventListener('click', (e) => {
                    if (e.target === designArea || e.target.classList.contains('grid-overlay')) {
                        this.selectComponent(null);
                    }
                });
            }

            snapToGrid(value) {
                if (!this.snapEnabled) return value;
                return Math.round(value / this.snapGrid) * this.snapGrid;
            }

            createComponent(type, config = {}) {
                const componentDef = this.availableComponents[type];
                if (!componentDef) return null;

                const component = {
                    id: `comp_${this.nextId++}`,
                    type: type,
                    name: componentDef.name,
                    config: {
                        ...componentDef.defaultConfig,
                        ...config.config
                    },
                    position: {
                        x: config.position?.x || 50,
                        y: config.position?.y || 50
                    },
                    size: config.size || {
                        width: type === 'container' ? '800px' : 'auto',
                        height: 'auto'
                    },
                    zIndex: this.components.length + 1
                };

                this.components.push(component);
                this.selectComponent(component.id);
                this.saveHistory();
                this.renderDesignArea();
                this.updateLayersPanel();
                
                this.showToast(`Componente "${componentDef.name}" añadido`, 'success');
                return component;
            }

            renderDesignArea() {
                const designArea = document.getElementById('designArea');
                const placeholder = document.getElementById('placeholder');
                
                // Limpiar componentes existentes
                const existing = designArea.querySelectorAll('.dropped-component');
                existing.forEach(el => el.remove());
                
                // Mostrar/ocultar placeholder
                if (this.components.length === 0) {
                    placeholder.style.display = 'block';
                } else {
                    placeholder.style.display = 'none';
                    
                    // Renderizar cada componente
                    this.components.forEach(comp => {
                        const element = this.createComponentElement(comp);
                        designArea.appendChild(element);
                    });
                }
                
                this.updateCodeEditor();
            }

            createComponentElement(component) {
                const element = document.createElement('div');
                element.className = `dropped-component fade-in`;
                element.id = component.id;
                element.style.left = `${component.position.x}px`;
                element.style.top = `${component.position.y}px`;
                element.style.zIndex = component.zIndex;
                
                if (component.size.width !== 'auto') {
                    element.style.width = component.size.width;
                }
                if (component.size.height !== 'auto') {
                    element.style.height = component.size.height;
                }
                
                if (this.selectedComponent === component.id) {
                    element.classList.add('selected');
                }
                
                // Contenido del componente
                const content = this.generateComponentHTML(component);
                element.innerHTML = `
                    <div class="component-header">
                        <span>${component.name}</span>
                        <div class="component-controls">
                            <button class="component-btn" onclick="gripes.bringToFront('${component.id}')" title="Traer al frente">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button class="component-btn" onclick="gripes.sendToBack('${component.id}')" title="Enviar atrás">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                            <button class="component-btn" onclick="gripes.deleteComponent('${component.id}')" title="Eliminar">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="component-content">
                        ${content}
                    </div>
                    <div class="resize-handle"></div>
                `;
                
                // Hacer arrastrable
                this.makeDraggable(element, component);
                this.makeResizable(element, component);
                
                // Click para seleccionar
                element.addEventListener('click', (e) => {
                    if (!e.target.closest('.component-controls')) {
                        this.selectComponent(component.id);
                    }
                });
                
                return element;
            }

            generateComponentHTML(component) {
                const config = component.config;
                
                switch(component.type) {
                    case 'header':
                        return `<${config.level} style="color: ${config.color}; text-align: ${config.align}; font-size: ${config.size}; margin: ${config.margin};">${config.text}</${config.level}>`;
                    
                    case 'paragraph':
                        return `<p style="color: ${config.color}; text-align: ${config.align}; font-size: ${config.size}; line-height: ${config.lineHeight};">${config.text}</p>`;
                    
                    case 'button':
                        return `<button style="background: ${config.backgroundColor}; color: white; padding: ${config.padding}; border: none; border-radius: ${config.borderRadius}; font-size: ${config.size === 'small' ? '0.875rem' : config.size === 'large' ? '1.25rem' : '1rem'}; cursor: pointer;">${config.text}</button>`;
                    
                    case 'image':
                        return `<img src="${config.src}" alt="${config.alt}" style="width: ${config.width}; height: ${config.height}; border-radius: ${config.borderRadius}; display: block;">`;
                    
                    case 'divider':
                        return `<hr style="border: ${config.thickness} ${config.style} ${config.color}; margin: ${config.margin};">`;
                    
                    case 'input':
                        return `<input type="${config.type}" placeholder="${config.placeholder}" style="width: ${config.width}; padding: ${config.padding}; border: 1px solid ${config.borderColor}; border-radius: ${config.borderRadius};">`;
                    
                    case 'textarea':
                        return `<textarea rows="${config.rows}" placeholder="${config.placeholder}" style="width: ${config.width}; padding: ${config.padding}; border: 1px solid ${config.borderColor}; border-radius: ${config.borderRadius};">${config.text || ''}</textarea>`;
                    
                    case 'select':
                        const options = config.options.map(opt => `<option>${opt}</option>`).join('');
                        return `<select style="width: ${config.width}; padding: ${config.padding}; border: 1px solid ${config.borderColor}; border-radius: ${config.borderRadius};">${options}</select>`;
                    
                    case 'checkbox':
                        return `<label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" ${config.checked ? 'checked' : ''}> ${config.label}</label>`;
                    
                    case 'radio':
                        return `<label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="${config.group}" ${config.checked ? 'checked' : ''}> ${config.label}</label>`;
                    
                    case 'container':
                        return `<div style="width: ${config.width}; padding: ${config.padding}; background: ${config.backgroundColor}; border-radius: ${config.borderRadius}; border: ${config.border};">Contenido del contenedor</div>`;
                    
                    case 'card':
                        return `
                            <div style="padding: ${config.padding}; background: ${config.backgroundColor}; border-radius: ${config.borderRadius}; box-shadow: ${config.boxShadow};">
                                <img src="${config.image}" alt="Card" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 15px;">
                                <h3 style="margin: 0 0 10px 0; color: #333;">${config.title}</h3>
                                <p style="color: #666; margin: 0;">${config.content}</p>
                            </div>
                        `;
                    
                    case 'navbar':
                        const menuItems = config.menuItems.map(item => `<a href="#" style="color: ${config.textColor}; text-decoration: none; margin: 0 15px;">${item}</a>`).join('');
                        return `
                            <div style="background: ${config.backgroundColor}; padding: ${config.padding}; display: flex; justify-content: space-between; align-items: center;">
                                <div style="color: ${config.textColor}; font-weight: bold; font-size: 1.2rem;">${config.logo}</div>
                                <div>${menuItems}</div>
                            </div>
                        `;
                    
                    case 'progress':
                        return `
                            <div style="width: 100%;">
                                <div style="width: 100%; height: ${config.height}; background: #e0e0e0; border-radius: 10px; overflow: hidden;">
                                    <div style="width: ${config.value}%; height: 100%; background: ${config.color};"></div>
                                </div>
                                ${config.showPercentage ? `<div style="text-align: center; margin-top: 5px; color: #666;">${config.value}%</div>` : ''}
                            </div>
                        `;
                    
                    default:
                        return `<div>${component.name} - ${component.type}</div>`;
                }
            }

            makeDraggable(element, component) {
                let isDragging = false;
                let startX, startY, startLeft, startTop;
                
                const header = element.querySelector('.component-header');
                
                const startDrag = (e) => {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startLeft = element.offsetLeft;
                    startTop = element.offsetTop;
                    
                    element.style.cursor = 'grabbing';
                    document.body.style.userSelect = 'none';
                    
                    e.preventDefault();
                };
                
                const doDrag = (e) => {
                    if (!isDragging) return;
                    
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    
                    let newLeft = startLeft + dx;
                    let newTop = startTop + dy;
                    
                    // Aplicar snapping si está activado
                    if (this.snapEnabled) {
                        newLeft = this.snapToGrid(newLeft);
                        newTop = this.snapToGrid(newTop);
                    }
                    
                    element.style.left = `${newLeft}px`;
                    element.style.top = `${newTop}px`;
                };
                
                const stopDrag = () => {
                    if (!isDragging) return;
                    
                    isDragging = false;
                    element.style.cursor = '';
                    document.body.style.userSelect = '';
                    
                    // Actualizar posición en el componente
                    const comp = this.components.find(c => c.id === component.id);
                    if (comp) {
                        comp.position.x = parseInt(element.style.left);
                        comp.position.y = parseInt(element.style.top);
                        this.saveHistory();
                    }
                };
                
                header.addEventListener('mousedown', startDrag);
                document.addEventListener('mousemove', doDrag);
                document.addEventListener('mouseup', stopDrag);
            }

            makeResizable(element, component) {
                const handle = element.querySelector('.resize-handle');
                let isResizing = false;
                let startX, startY, startWidth, startHeight;
                
                const startResize = (e) => {
                    isResizing = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startWidth = element.offsetWidth;
                    startHeight = element.offsetHeight;
                    
                    document.body.style.userSelect = 'none';
                    e.stopPropagation();
                    e.preventDefault();
                };
                
                const doResize = (e) => {
                    if (!isResizing) return;
                    
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    
                    let newWidth = startWidth + dx;
                    let newHeight = startHeight + dy;
                    
                    // Aplicar snapping si está activado
                    if (this.snapEnabled) {
                        newWidth = this.snapToGrid(newWidth);
                        newHeight = this.snapToGrid(newHeight);
                    }
                    
                    // Establecer límites mínimos
                    newWidth = Math.max(newWidth, 50);
                    newHeight = Math.max(newHeight, 50);
                    
                    element.style.width = `${newWidth}px`;
                    element.style.height = `${newHeight}px`;
                };
                
                const stopResize = () => {
                    if (!isResizing) return;
                    
                    isResizing = false;
                    document.body.style.userSelect = '';
                    
                    // Actualizar tamaño en el componente
                    const comp = this.components.find(c => c.id === component.id);
                    if (comp) {
                        comp.size.width = `${element.offsetWidth}px`;
                        comp.size.height = `${element.offsetHeight}px`;
                        this.saveHistory();
                    }
                };
                
                handle.addEventListener('mousedown', startResize);
                document.addEventListener('mousemove', doResize);
                document.addEventListener('mouseup', stopResize);
            }

            selectComponent(id) {
                this.selectedComponent = id;
                this.renderDesignArea();
                this.updatePropertiesPanel();
                this.updateLayersPanel();
            }

            updateComponent(id, config) {
                const component = this.components.find(c => c.id === id);
                if (component) {
                    component.config = { ...component.config, ...config };
                    this.saveHistory();
                    this.renderDesignArea();
                    this.updatePropertiesPanel();
                }
            }

            deleteComponent(id) {
                const index = this.components.findIndex(c => c.id === id);
                if (index !== -1) {
                    this.components.splice(index, 1);
                    this.selectComponent(null);
                    this.saveHistory();
                    this.renderDesignArea();
                    this.updateLayersPanel();
                    this.showToast('Componente eliminado', 'success');
                }
            }

            bringToFront(id) {
                const component = this.components.find(c => c.id === id);
                if (component) {
                    const maxZ = Math.max(...this.components.map(c => c.zIndex));
                    component.zIndex = maxZ + 1;
                    this.saveHistory();
                    this.renderDesignArea();
                    this.showToast('Componente traído al frente', 'info');
                }
            }

            sendToBack(id) {
                const component = this.components.find(c => c.id === id);
                if (component) {
                    const minZ = Math.min(...this.components.map(c => c.zIndex));
                    component.zIndex = Math.max(minZ - 1, 1);
                    this.saveHistory();
                    this.renderDesignArea();
                    this.showToast('Componente enviado atrás', 'info');
                }
            }

            clearAll() {
                if (this.components.length > 0) {
                    if (confirm('¿Estás seguro de que quieres eliminar todos los componentes?')) {
                        this.components = [];
                        this.selectedComponent = null;
                        this.saveHistory();
                        this.renderDesignArea();
                        this.updateLayersPanel();
                        this.showToast('Todos los componentes eliminados', 'success');
                    }
                }
            }

            saveHistory() {
                // Guardar solo los últimos 50 estados
                this.history = this.history.slice(0, this.historyIndex + 1);
                this.history.push(JSON.parse(JSON.stringify(this.components)));
                this.historyIndex++;
                
                if (this.history.length > 50) {
                    this.history.shift();
                    this.historyIndex--;
                }
            }

            undo() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    this.components = JSON.parse(JSON.stringify(this.history[this.historyIndex]));
                    this.renderDesignArea();
                    this.updateLayersPanel();
                    this.showToast('Deshacer', 'info');
                }
            }

            redo() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.components = JSON.parse(JSON.stringify(this.history[this.historyIndex]));
                    this.renderDesignArea();
                    this.updateLayersPanel();
                    this.showToast('Rehacer', 'info');
                }
            }

            // Renderización de componentes en el panel lateral
            renderComponentPanel() {
                const container = document.getElementById('componentsContainer');
                const categories = {};
                
                // Organizar componentes por categoría
                Object.entries(this.availableComponents).forEach(([key, component]) => {
                    if (!categories[component.category]) {
                        categories[component.category] = [];
                    }
                    categories[component.category].push({ key, ...component });
                });
                
                // Renderizar cada categoría
                container.innerHTML = '';
                Object.entries(categories).forEach(([categoryName, components]) => {
                    const categoryHtml = `
                        <div class="category">
                            <div class="category-title">
                                <i class="fas fa-folder"></i>
                                ${categoryName}
                            </div>
                            <div class="components-grid">
                                ${components.map(comp => `
                                    <div class="component-item" 
                                         draggable="true" 
                                         data-type="${comp.key}"
                                         title="${comp.name}">
                                        <i class="${comp.icon}"></i>
                                        <span>${comp.name}</span>
                                        <div class="component-tags">
                                            ${comp.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    container.innerHTML += categoryHtml;
                });
                
                // Configurar eventos de drag & drop
                document.querySelectorAll('.component-item').forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('component-type', e.target.closest('.component-item').dataset.type);
                        e.dataTransfer.effectAllowed = 'copy';
                    });
                });
                
                // Búsqueda de componentes
                document.getElementById('searchBox').addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    document.querySelectorAll('.component-item').forEach(item => {
                        const text = item.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        item.style.display = isVisible ? 'flex' : 'none';
                    });
                });
            }

            // Panel de propiedades
            updatePropertiesPanel() {
                const panel = document.getElementById('propertiesPanel');
                
                if (!this.selectedComponent) {
                    panel.innerHTML = `
                        <div class="placeholder" style="position: relative; transform: none; padding: 40px 20px;">
                            <i class="fas fa-mouse-pointer"></i>
                            <h3>Selecciona un componente</h3>
                            <p>Haz clic en cualquier componente del área de diseño para editar sus propiedades</p>
                        </div>
                    `;
                    return;
                }
                
                const component = this.components.find(c => c.id === this.selectedComponent);
                if (!component) return;
                
                const componentDef = this.availableComponents[component.type];
                const config = component.config;
                
                let propertiesHtml = `
                    <div class="properties-group">
                        <div class="group-title">
                            <i class="fas fa-cog"></i>
                            Propiedades Generales
                        </div>
                        <div class="property">
                            <label>Nombre</label>
                            <input type="text" class="property-input" id="propName" value="${component.name}" onchange="gripes.updateComponentName('${component.id}', this.value)">
                        </div>
                        <div class="property-row">
                            <div class="property" style="flex: 1;">
                                <label>Posición X</label>
                                <input type="number" class="property-input" value="${component.position.x}" onchange="gripes.updateComponentPosition('${component.id}', 'x', this.value)">
                            </div>
                            <div class="property" style="flex: 1;">
                                <label>Posición Y</label>
                                <input type="number" class="property-input" value="${component.position.y}" onchange="gripes.updateComponentPosition('${component.id}', 'y', this.value)">
                            </div>
                        </div>
                        <div class="property-row">
                            <div class="property" style="flex: 1;">
                                <label>Ancho</label>
                                <input type="text" class="property-input" value="${component.size.width}" onchange="gripes.updateComponentSize('${component.id}', 'width', this.value)">
                            </div>
                            <div class="property" style="flex: 1;">
                                <label>Alto</label>
                                <input type="text" class="property-input" value="${component.size.height}" onchange="gripes.updateComponentSize('${component.id}', 'height', this.value)">
                            </div>
                        </div>
                    </div>
                `;
                
                // Propiedades específicas del componente
                if (component.type === 'header') {
                    propertiesHtml += `
                        <div class="properties-group">
                            <div class="group-title">
                                <i class="fas fa-heading"></i>
                                Propiedades de Encabezado
                            </div>
                            <div class="property">
                                <label>Texto</label>
                                <input type="text" class="property-input" value="${config.text}" onchange="gripes.updateComponentConfig('${component.id}', 'text', this.value)">
                            </div>
                            <div class="property">
                                <label>Nivel</label>
                                <select class="property-input" onchange="gripes.updateComponentConfig('${component.id}', 'level', this.value)">
                                    <option value="h1" ${config.level === 'h1' ? 'selected' : ''}>H1</option>
                                    <option value="h2" ${config.level === 'h2' ? 'selected' : ''}>H2</option>
                                    <option value="h3" ${config.level === 'h3' ? 'selected' : ''}>H3</option>
                                    <option value="h4" ${config.level === 'h4' ? 'selected' : ''}>H4</option>
                                    <option value="h5" ${config.level === 'h5' ? 'selected' : ''}>H5</option>
                                    <option value="h6" ${config.level === 'h6' ? 'selected' : ''}>H6</option>
                                </select>
                            </div>
                            <div class="property">
                                <label>Tamaño</label>
                                <input type="text" class="property-input" value="${config.size}" onchange="gripes.updateComponentConfig('${component.id}', 'size', this.value)">
                            </div>
                            <div class="property">
                                <label>Color</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input type="color" class="property-input" value="${config.color}" onchange="gripes.updateComponentConfig('${component.id}', 'color', this.value)" style="flex: 1;">
                                    <span>${config.color}</span>
                                </div>
                            </div>
                            <div class="property">
                                <label>Alineación</label>
                                <select class="property-input" onchange="gripes.updateComponentConfig('${component.id}', 'align', this.value)">
                                    <option value="left" ${config.align === 'left' ? 'selected' : ''}>Izquierda</option>
                                    <option value="center" ${config.align === 'center' ? 'selected' : ''}>Centro</option>
                                    <option value="right" ${config.align === 'right' ? 'selected' : ''}>Derecha</option>
                                    <option value="justify" ${config.align === 'justify' ? 'selected' : ''}>Justificado</option>
                                </select>
                            </div>
                        </div>
                    `;
                } else if (component.type === 'button') {
                    propertiesHtml += `
                        <div class="properties-group">
                            <div class="group-title">
                                <i class="fas fa-square"></i>
                                Propiedades de Botón
                            </div>
                            <div class="property">
                                <label>Texto</label>
                                <input type="text" class="property-input" value="${config.text}" onchange="gripes.updateComponentConfig('${component.id}', 'text', this.value)">
                            </div>
                            <div class="property">
                                <label>Tamaño</label>
                                <select class="property-input" onchange="gripes.updateComponentConfig('${component.id}', 'size', this.value)">
                                    <option value="small" ${config.size === 'small' ? 'selected' : ''}>Pequeño</option>
                                    <option value="medium" ${config.size === 'medium' ? 'selected' : ''}>Mediano</option>
                                    <option value="large" ${config.size === 'large' ? 'selected' : ''}>Grande</option>
                                </select>
                            </div>
                            <div class="property">
                                <label>Color de Fondo</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input type="color" class="property-input" value="${config.backgroundColor}" onchange="gripes.updateComponentConfig('${component.id}', 'backgroundColor', this.value)" style="flex: 1;">
                                    <span>${config.backgroundColor}</span>
                                </div>
                            </div>
                            <div class="property">
                                <label>Radio de Borde</label>
                                <input type="text" class="property-input" value="${config.borderRadius}" onchange="gripes.updateComponentConfig('${component.id}', 'borderRadius', this.value)">
                            </div>
                            <div class="property">
                                <label>Padding</label>
                                <input type="text" class="property-input" value="${config.padding}" onchange="gripes.updateComponentConfig('${component.id}', 'padding', this.value)">
                            </div>
                        </div>
                    `;
                }
                
                panel.innerHTML = propertiesHtml;
            }

            updateComponentName(id, name) {
                const component = this.components.find(c => c.id === id);
                if (component) {
                    component.name = name;
                    this.saveHistory();
                    this.updateLayersPanel();
                    this.renderDesignArea();
                }
            }

            updateComponentPosition(id, axis, value) {
                const component = this.components.find(c => c.id === id);
                if (component) {
                    component.position[axis] = parseInt(value) || 0;
                    this.saveHistory();
                    this.renderDesignArea();
                }
            }

            updateComponentSize(id, dimension, value) {
                const component = this.components.find(c => c.id === id);
                if (component) {
                    component.size[dimension] = value;
                    this.saveHistory();
                    this.renderDesignArea();
                }
            }

            updateComponentConfig(id, key, value) {
                const component = this.components.find(c => c.id === id);
                if (component) {
                    component.config[key] = value;
                    this.saveHistory();
                    this.renderDesignArea();
                }
            }

            // Panel de capas
            updateLayersPanel() {
                const list = document.getElementById('layersList');
                const sortedComponents = [...this.components].sort((a, b) => b.zIndex - a.zIndex);
                
                list.innerHTML = sortedComponents.map(comp => `
                    <div class="layer-item ${this.selectedComponent === comp.id ? 'selected' : ''}" 
                         onclick="gripes.selectComponent('${comp.id}')">
                        <div class="layer-icon">
                            <i class="${this.availableComponents[comp.type]?.icon || 'fas fa-cube'}"></i>
                        </div>
                        <div class="layer-info">
                            <div class="layer-name">${comp.name}</div>
                            <div class="layer-type">${this.availableComponents[comp.type]?.name || comp.type}</div>
                        </div>
                        <div class="layer-actions">
                            <button class="component-btn" onclick="event.stopPropagation(); gripes.bringToFront('${comp.id}')" title="Traer al frente">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button class="component-btn" onclick="event.stopPropagation(); gripes.sendToBack('${comp.id}')" title="Enviar atrás">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            // Editor de código
            updateCodeEditor() {
                const editor = document.getElementById('codeEditor');
                const html = this.generateFullHTML();
                editor.value = html;
                
                // Actualizar números de línea
                const lines = html.split('\n').length;
                document.getElementById('codeLines').innerHTML = Array.from({length: lines}, (_, i) => i + 1).join('<br>');
            }

            generateFullHTML() {
                let html = `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diseño GripesJS Pro</title>
    <style>
        /* Estilos generales */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            padding: 20px;
            min-height: 100vh;
        }
        
        .gripesjs-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Estilos de componentes */
        ${this.generateComponentStyles()}
        
        /* Estilos responsive */
        @media (max-width: 768px) {
            .gripesjs-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="gripesjs-container">
`;
                
                this.components.forEach(comp => {
                    const styles = this.generateInlineStyles(comp);
                    const content = this.generateComponentHTML(comp);
                    
                    html += `        <div class="gripes-component ${comp.type}" style="${styles}">
            ${content}
        </div>\n`;
                });
                
                html += `    </div>
</body>
</html>`;
                
                return html;
            }

            generateComponentStyles() {
                return `
        .gripes-component {
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .gripes-component.header {
            font-family: 'Segoe UI', sans-serif;
        }
        
        .gripes-component.button {
            display: inline-block;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .gripes-component.button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .gripes-component.card {
            overflow: hidden;
        }
        
        .gripes-component.image img {
            max-width: 100%;
            height: auto;
        }
                `;
            }

            generateInlineStyles(component) {
                let styles = `position: absolute; left: ${component.position.x}px; top: ${component.position.y}px; z-index: ${component.zIndex};`;
                
                if (component.size.width !== 'auto') {
                    styles += `width: ${component.size.width};`;
                }
                if (component.size.height !== 'auto') {
                    styles += `height: ${component.size.height};`;
                }
                
                return styles;
            }

            // Sistema de exportación
            setupExportOptions() {
                const exportGrid = document.getElementById('exportGrid');
                const exportOptions = [
                    {
                        icon: 'fab fa-html5',
                        title: 'HTML Completo',
                        description: 'Exporta como archivo HTML con todos los estilos incluidos',
                        type: 'html'
                    },
                    {
                        icon: 'fas fa-code',
                        title: 'Solo HTML',
                        description: 'Solo el código HTML sin estilos',
                        type: 'html-only'
                    },
                    {
                        icon: 'fas fa-css3-alt',
                        title: 'HTML + CSS',
                        description: 'HTML con archivo CSS separado',
                        type: 'html-css'
                    },
                    {
                        icon: 'fas fa-file-code',
                        title: 'React Component',
                        description: 'Exporta como componente React',
                        type: 'react'
                    },
                    {
                        icon: 'fab fa-vuejs',
                        title: 'Vue Component',
                        description: 'Exporta como componente Vue',
                        type: 'vue'
                    },
                    {
                        icon: 'fas fa-database',
                        title: 'JSON',
                        description: 'Estructura completa del proyecto',
                        type: 'json'
                    },
                    {
                        icon: 'fas fa-image',
                        title: 'Captura PNG',
                        description: 'Captura del diseño actual',
                        type: 'png'
                    },
                    {
                        icon: 'fas fa-file-pdf',
                        title: 'PDF',
                        description: 'Exporta a documento PDF',
                        type: 'pdf'
                    }
                ];
                
                exportGrid.innerHTML = exportOptions.map(option => `
                    <div class="export-card" data-export="${option.type}">
                        <i class="${option.icon}"></i>
                        <h4>${option.title}</h4>
                        <p>${option.description}</p>
                    </div>
                `).join('');
                
                // Event listeners para exportación
                document.querySelectorAll('.export-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const type = e.currentTarget.dataset.export;
                        this.exportProject(type);
                    });
                });
            }

            exportProject(type) {
                switch(type) {
                    case 'html':
                        this.exportHTML();
                        break;
                    case 'html-only':
                        this.exportHTMLOnly();
                        break;
                    case 'html-css':
                        this.exportHTMLCSS();
                        break;
                    case 'react':
                        this.exportReact();
                        break;
                    case 'vue':
                        this.exportVue();
                        break;
                    case 'json':
                        this.exportJSON();
                        break;
                    case 'png':
                        this.exportPNG();
                        break;
                    case 'pdf':
                        this.showToast('Exportación a PDF no disponible en esta versión', 'warning');
                        break;
                }
                
                document.getElementById('exportModal').classList.remove('active');
            }

            exportHTML() {
                const html = this.generateFullHTML();
                this.downloadFile(html, 'gripesjs-design.html', 'text/html');
                this.showToast('Proyecto exportado como HTML', 'success');
            }

            exportHTMLOnly() {
                let html = `<!-- HTML generado por GripesJS Pro -->\n<div class="gripesjs-container">\n`;
                
                this.components.forEach(comp => {
                    const styles = this.generateInlineStyles(comp);
                    const content = this.generateComponentHTML(comp);
                    html += `    <div class="gripes-component ${comp.type}" style="${styles}">\n        ${content}\n    </div>\n`;
                });
                
                html += `</div>`;
                
                this.downloadFile(html, 'gripesjs-design.html', 'text/html');
                this.showToast('HTML exportado', 'success');
            }

            exportHTMLCSS() {
                const html = this.generateFullHTML();
                const css = this.generateComponentStyles();
                
                // Separar HTML y CSS
                const htmlOnly = html.replace(/<style>[\s\S]*?<\/style>/, '');
                const cssFile = `/* CSS generado por GripesJS Pro */\n${css}`;
                
                // Crear archivo ZIP (simulado)
                const combined = `=== HTML ===\n\n${htmlOnly}\n\n=== CSS ===\n\n${cssFile}`;
                
                this.downloadFile(combined, 'gripesjs-design.txt', 'text/plain');
                this.showToast('HTML y CSS exportados', 'success');
            }

            exportReact() {
                let reactCode = `import React from 'react';
import './GripesJSDesign.css';

const GripesJSDesign = () => {
    return (
        <div className="gripesjs-container">
`;
                
                this.components.forEach(comp => {
                    const content = this.generateComponentHTML(comp)
                        .replace(/class=/g, 'className=')
                        .replace(/style="([^"]*)"/g, (match, styles) => {
                            const reactStyles = styles.split(';').reduce((obj, style) => {
                                if (style.trim()) {
                                    const [key, value] = style.split(':').map(s => s.trim());
                                    const reactKey = key.replace(/-([a-z])/g, g => g[1].toUpperCase());
                                    obj[reactKey] = value;
                                }
                                return obj;
                            }, {});
                            return `style={${JSON.stringify(reactStyles)}}`;
                        });
                    
                    reactCode += `            <div className="gripes-component ${comp.type}">
                ${content}
            </div>\n`;
                });
                
                reactCode += `        </div>
    );
};

export default GripesJSDesign;`;
                
                this.downloadFile(reactCode, 'GripesJSDesign.jsx', 'text/javascript');
                this.showToast('Componente React exportado', 'success');
            }

            exportVue() {
                let vueCode = `<template>
    <div class="gripesjs-container">
`;
                
                this.components.forEach(comp => {
                    vueCode += `        <div class="gripes-component ${comp.type}">
            ${this.generateComponentHTML(comp)}
        </div>\n`;
                });
                
                vueCode += `    </div>
</template>

<script>
export default {
    name: 'GripesJSDesign'
}
</script>

<style scoped>
${this.generateComponentStyles()}
</style>`;
                
                this.downloadFile(vueCode, 'GripesJSDesign.vue', 'text/plain');
                this.showToast('Componente Vue exportado', 'success');
            }

            exportJSON() {
                const projectData = {
                    metadata: {
                        name: 'GripesJS Design',
                        generatedBy: 'GripesJS Studio Pro',
                        version: '1.0',
                        timestamp: new Date().toISOString()
                    },
                    settings: {
                        snapGrid: this.snapGrid,
                        snapEnabled: this.snapEnabled,
                        pageSize: this.currentPageSize
                    },
                    components: this.components
                };
                
                const json = JSON.stringify(projectData, null, 2);
                this.downloadFile(json, 'gripesjs-design.json', 'application/json');
                this.showToast('Proyecto exportado como JSON', 'success');
            }

            exportPNG() {
                this.showToast('Para capturar PNG, usa la herramienta de captura de pantalla de tu navegador', 'info');
            }

            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // Gestión de proyectos
            saveProject() {
                const projectData = {
                    metadata: {
                        name: prompt('Nombre del proyecto:', 'Mi diseño GripesJS'),
                        timestamp: new Date().toISOString()
                    },
                    components: this.components
                };
                
                const json = JSON.stringify(projectData);
                localStorage.setItem('gripesjs-projects', JSON.stringify({
                    ...JSON.parse(localStorage.getItem('gripesjs-projects') || '{}'),
                    [Date.now()]: projectData
                }));
                
                this.showToast('Proyecto guardado localmente', 'success');
            }

            loadProject() {
                const projects = JSON.parse(localStorage.getItem('gripesjs-projects') || '{}');
                const projectList = Object.entries(projects).map(([key, project]) => 
                    `<option value="${key}">${project.metadata.name} - ${new Date(project.metadata.timestamp).toLocaleString()}</option>`
                ).join('');
                
                const modalContent = document.getElementById('projectModalContent');
                modalContent.innerHTML = `
                    <h3 style="margin-bottom: 20px; color: var(--dark);">Proyectos Guardados</h3>
                    ${Object.keys(projects).length > 0 ? `
                        <div class="property">
                            <label>Seleccionar proyecto:</label>
                            <select class="property-input" id="projectSelect" style="margin-bottom: 20px;">
                                ${projectList}
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="gripes.loadSelectedProject()">Cargar</button>
                            <button class="btn btn-danger" onclick="gripes.deleteSelectedProject()">Eliminar</button>
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 40px 20px;">
                            <i class="fas fa-folder-open" style="font-size: 3rem; color: var(--gray); margin-bottom: 20px;"></i>
                            <h3 style="color: var(--dark); margin-bottom: 10px;">No hay proyectos guardados</h3>
                            <p style="color: var(--gray);">Guarda un proyecto primero para poder cargarlo más tarde.</p>
                        </div>
                    `}
                `;
                
                document.getElementById('projectModalTitle').textContent = 'Cargar Proyecto';
                document.getElementById('projectModal').classList.add('active');
            }

            loadSelectedProject() {
                const select = document.getElementById('projectSelect');
                if (!select) return;
                
                const projectKey = select.value;
                const projects = JSON.parse(localStorage.getItem('gripesjs-projects') || '{}');
                const project = projects[projectKey];
                
                if (project) {
                    this.components = project.components;
                    this.selectedComponent = null;
                    this.saveHistory();
                    this.renderDesignArea();
                    this.updateLayersPanel();
                    this.updatePropertiesPanel();
                    
                    document.getElementById('projectModal').classList.remove('active');
                    this.showToast('Proyecto cargado', 'success');
                }
            }

            deleteSelectedProject() {
                const select = document.getElementById('projectSelect');
                if (!select) return;
                
                const projectKey = select.value;
                const projects = JSON.parse(localStorage.getItem('gripesjs-projects') || '{}');
                
                if (confirm(`¿Eliminar el proyecto "${projects[projectKey]?.metadata.name}"?`)) {
                    delete projects[projectKey];
                    localStorage.setItem('gripesjs-projects', JSON.stringify(projects));
                    this.loadProject(); // Recargar la lista
                    this.showToast('Proyecto eliminado', 'success');
                }
            }

            // Utilidades
            updateGrid() {
                const gridSize = parseInt(document.getElementById('gridSelect').value);
                this.snapGrid = gridSize;
                
                const gridOverlay = document.getElementById('gridOverlay');
                if (gridSize > 0) {
                    gridOverlay.style.backgroundSize = `${gridSize}px ${gridSize}px`;
                    gridOverlay.style.display = 'block';
                } else {
                    gridOverlay.style.display = 'none';
                }
            }

            toggleSnap() {
                this.snapEnabled = !this.snapEnabled;
                const button = document.getElementById('snapToggle');
                button.classList.toggle('btn-primary', this.snapEnabled);
                button.classList.toggle('btn-light', !this.snapEnabled);
                this.showToast(`Snapping ${this.snapEnabled ? 'activado' : 'desactivado'}`, 'info');
            }

            showContextMenu(e) {
                e.preventDefault();
                // Implementación básica del menú contextual
                const menu = document.createElement('div');
                menu.style.cssText = `
                    position: fixed;
                    left: ${e.clientX}px;
                    top: ${e.clientY}px;
                    background: white;
                    border: 1px solid var(--border);
                    border-radius: 8px;
                    box-shadow: var(--shadow);
                    z-index: 1000;
                    min-width: 200px;
                `;
                
                menu.innerHTML = `
                    <div style="padding: 10px 0;">
                        <div style="padding: 10px 20px; font-weight: 500; color: var(--dark); border-bottom: 1px solid var(--border);">
                            <i class="fas fa-plus"></i> Añadir componente
                        </div>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${Object.entries(this.availableComponents).slice(0, 10).map(([key, comp]) => `
                                <div onclick="gripes.createComponentAtPosition('${key}', ${e.clientX}, ${e.clientY})" 
                                     style="padding: 10px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: background 0.2s;">
                                    <i class="${comp.icon}" style="color: var(--primary);"></i>
                                    <span>${comp.name}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                document.body.appendChild(menu);
                
                // Cerrar menú al hacer clic fuera
                setTimeout(() => {
                    const closeMenu = (click) => {
                        if (!menu.contains(click.target)) {
                            document.body.removeChild(menu);
                            document.removeEventListener('click', closeMenu);
                        }
                    };
                    document.addEventListener('click', closeMenu);
                }, 10);
            }

            createComponentAtPosition(type, clientX, clientY) {
                const designArea = document.getElementById('designArea');
                const rect = designArea.getBoundingClientRect();
                const x = clientX - rect.left - 50;
                const y = clientY - rect.top - 50;
                
                this.createComponent(type, {
                    position: { x: this.snapToGrid(x), y: this.snapToGrid(y) }
                });
            }

            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <div>${message}</div>
                `;
                
                container.appendChild(toast);
                
                // Animación de entrada
                setTimeout(() => toast.classList.add('show'), 10);
                
                // Eliminar después de 3 segundos
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            }

            alignComponents(direction) {
                if (!this.selectedComponent) {
                    this.showToast('Selecciona un componente primero', 'warning');
                    return;
                }
                
                const component = this.components.find(c => c.id === this.selectedComponent);
                if (!component) return;
                
                const designArea = document.getElementById('designArea');
                const areaWidth = designArea.offsetWidth;
                
                let newX = component.position.x;
                
                switch(direction) {
                    case 'left':
                        newX = 0;
                        break;
                    case 'center':
                        newX = (areaWidth - (component.size.width === 'auto' ? 200 : parseInt(component.size.width))) / 2;
                        break;
                    case 'right':
                        newX = areaWidth - (component.size.width === 'auto' ? 200 : parseInt(component.size.width));
                        break;
                }
                
                component.position.x = this.snapToGrid(newX);
                this.saveHistory();
                this.renderDesignArea();
                this.showToast(`Componente alineado a la ${direction === 'left' ? 'izquierda' : direction === 'center' ? 'centro' : 'derecha'}`, 'info');
            }
        }

        // ================================
        // INICIALIZACIÓN DE LA APLICACIÓN
        // ================================
        const gripes = new GripesJS();
        window.gripes = gripes;

        // Configuración de eventos del DOM
        document.addEventListener('DOMContentLoaded', () => {
            // Botones del header
            document.getElementById('saveBtn').addEventListener('click', () => gripes.saveProject());
            document.getElementById('loadBtn').addEventListener('click', () => gripes.loadProject());
            document.getElementById('clearBtn').addEventListener('click', () => gripes.clearAll());
            document.getElementById('exportBtn').addEventListener('click', () => {
                document.getElementById('exportModal').classList.add('active');
            });
            document.getElementById('previewBtn').addEventListener('click', () => {
                window.open().document.write(gripes.generateFullHTML());
            });

            // Botones de herramientas
            document.getElementById('undoBtn').addEventListener('click', () => gripes.undo());
            document.getElementById('redoBtn').addEventListener('click', () => gripes.redo());
            document.getElementById('alignLeftBtn').addEventListener('click', () => gripes.alignComponents('left'));
            document.getElementById('alignCenterBtn').addEventListener('click', () => gripes.alignComponents('center'));
            document.getElementById('alignRightBtn').addEventListener('click', () => gripes.alignComponents('right'));
            document.getElementById('snapToggle').addEventListener('click', () => gripes.toggleSnap());

            // Selectores
            document.getElementById('gridSelect').addEventListener('change', () => gripes.updateGrid());
            document.getElementById('zoomSelect').addEventListener('change', (e) => {
                const designArea = document.getElementById('designArea');
                designArea.style.transform = `scale(${e.target.value})`;
                designArea.style.transformOrigin = 'top left';
            });
            document.getElementById('sizeSelect').addEventListener('change', (e) => {
                const designArea = document.getElementById('designArea');
                const sizes = {
                    'desktop': '1200px',
                    'tablet': '768px',
                    'mobile': '375px',
                    'full': '100%'
                };
                designArea.style.width = sizes[e.target.value];
                gripes.currentPageSize = e.target.value;
            });

            // Tabs del sidebar derecho
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.dataset.tab;
                    
                    // Actualizar botones activos
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Mostrar contenido correspondiente
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tab}Tab`).classList.add('active');
                });
            });

            // Botones de código
            document.getElementById('copyCodeBtn').addEventListener('click', () => {
                const code = document.getElementById('codeEditor').value;
                navigator.clipboard.writeText(code).then(() => {
                    gripes.showToast('Código copiado al portapapeles', 'success');
                });
            });
            document.getElementById('updateCodeBtn').addEventListener('click', () => {
                gripes.updateCodeEditor();
                gripes.showToast('Código actualizado', 'info');
            });

            // Modal de exportación
            document.getElementById('closeExportModal').addEventListener('click', () => {
                document.getElementById('exportModal').classList.remove('active');
            });
            document.getElementById('cancelExportBtn').addEventListener('click', () => {
                document.getElementById('exportModal').classList.remove('active');
            });
            document.getElementById('exportModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('exportModal')) {
                    document.getElementById('exportModal').classList.remove('active');
                }
            });

            // Modal de proyectos
            document.getElementById('closeProjectModal').addEventListener('click', () => {
                document.getElementById('projectModal').classList.remove('active');
            });
            document.getElementById('cancelProjectBtn').addEventListener('click', () => {
                document.getElementById('projectModal').classList.remove('active');
            });
            document.getElementById('projectModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('projectModal')) {
                    document.getElementById('projectModal').classList.remove('active');
                }
            });

            // Atajos de teclado
            document.addEventListener('keydown', (e) => {
                // Ctrl+Z para deshacer
                if (e.ctrlKey && e.key === 'z') {
                    e.preventDefault();
                    gripes.undo();
                }
                // Ctrl+Y para rehacer
                if (e.ctrlKey && e.key === 'y') {
                    e.preventDefault();
                    gripes.redo();
                }
                // Delete para eliminar componente seleccionado
                if (e.key === 'Delete' && gripes.selectedComponent) {
                    gripes.deleteComponent(gripes.selectedComponent);
                }
                // Escape para deseleccionar
                if (e.key === 'Escape') {
                    gripes.selectComponent(null);
                }
            });

            // Inicializar con algunos componentes de ejemplo
            setTimeout(() => {
                gripes.createComponent('navbar', {
                    position: { x: 50, y: 50 },
                    size: { width: '1100px', height: 'auto' }
                });
                
                gripes.createComponent('header', {
                    position: { x: 50, y: 120 },
                    size: { width: '1100px', height: 'auto' },
                    config: {
                        text: 'Bienvenido a GripesJS Studio Pro',
                        level: 'h1',
                        align: 'center'
                    }
                });
                
                gripes.createComponent('card', {
                    position: { x: 50, y: 220 },
                    size: { width: '500px', height: 'auto' }
                });
                
                gripes.createComponent('button', {
                    position: { x: 600, y: 300 },
                    config: {
                        text: 'Comenzar Ahora',
                        size: 'large'
                    }
                });
            }, 500);
        });
    </script>
</body>
</html>
