<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Alojamientos Provincia de Valladolid</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">

    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: system-ui, Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }

        .sidebar {
            position: absolute;
            top: 0; left: 0;
            width: 330px; height: 100%;
            background: #fff;
            box-shadow: 2px 0 8px rgba(0,0,0,.15);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            position: sticky;
            top: 0;
            background: #fff;
            padding: 15px;
            border-bottom: 1px solid #ddd;
            z-index: 10;
        }

        .search-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .hotel-list { flex: 1; overflow-y: auto; }

        .hotel-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .hotel-item:hover { background: #f2f6fa; }

        .stars { color: #e6a700; font-size: 13px; }

        .info-panel {
            padding: 12px 15px;
            background: #f7f7f7;
            border-top: 1px solid #ddd;
        }

        .hotel-image {
            width: 100%;
            height: 160px;
            margin-bottom: 10px;
            border-radius: 4px;
            overflow: hidden;
        }

        .hotel-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: relative;
                width: 100%;
                max-height: 50vh;
                border-bottom: 1px solid #ccc;
                box-shadow: none;
            }
            #map { height: calc(100vh - 50vh); }
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2>Alojamientos turísticos</h2>
        <input id="search" class="search-input" placeholder="Buscar por nombre o municipio…">
    </div>
    <div id="hotel-list" class="hotel-list"></div>
    <div id="info-panel" class="info-panel">
        <em>Selecciona un alojamiento</em>
    </div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
    const map = L.map('map', { zoomControl: false })
        .setView([41.6523, -4.7245], 9);

    L.control.zoom({ position: 'topright' }).addTo(map);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap'
    }).addTo(map);

    /* ============================
       DATASET: 200 ALOJAMIENTOS
       Provincia de Valladolid
    ============================ */

    const municipios = [
        "Valladolid","Peñafiel","Tordesillas","Medina del Campo",
        "Íscar","Olmedo","Laguna de Duero","Zaratán",
        "Simancas","Mayorga","Valbuena de Duero",
        "Quintanilla de Onésimo","Aldeamayor","Cigales"
    ];

    const tipos = [
        "Hotel","Hostal","Casa Rural","Apartamento Turístico",
        "Posada","Balneario","Alojamiento Rural"
    ];

    const images = [
        "https://images.unsplash.com/photo-1566073771259-6a8506099945",
        "https://images.unsplash.com/photo-1542314831-068cd1dbfeeb",
        "https://images.unsplash.com/photo-1505693416388-ac5ce068fe85",
        "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267"
    ];

    const hotels = [];

    for (let i = 1; i <= 200; i++) {
        const city = municipios[i % municipios.length];
        const tipo = tipos[i % tipos.length];

        hotels.push({
            name: `${tipo} ${city} ${i}`,
            city,
            stars: 3 + (i % 3),
            lat: 41.4 + Math.random() * 0.6,
            lng: -5.1 + Math.random() * 1.2,
            image: images[i % images.length]
        });
    }

    /* ============================
       VISOR (idéntico)
    ============================ */

    const cluster = L.markerClusterGroup();
    const list = document.getElementById('hotel-list');
    const info = document.getElementById('info-panel');
    const search = document.getElementById('search');

    const normalize = t =>
        t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

    const starsHTML = n => "★".repeat(n);

    function render(data) {
        list.innerHTML = "";
        cluster.clearLayers();

        data.forEach(h => {
            const m = L.marker([h.lat, h.lng])
                .bindTooltip(h.name)
                .bindPopup(`<b>${h.name}</b><br>${h.city}`);

            m.on('click', () => showInfo(h));
            cluster.addLayer(m);

            const item = document.createElement('div');
            item.className = 'hotel-item';
            item.innerHTML = `
                <strong>${h.name}</strong><br>
                <small>${h.city}</small><br>
                <span class="stars">${starsHTML(h.stars)}</span>
            `;
            item.onclick = () => {
                map.setView([h.lat, h.lng], 13);
                m.openPopup();
                showInfo(h);
            };
            list.appendChild(item);
        });

        map.addLayer(cluster);
    }

    function showInfo(h) {
        info.innerHTML = `
            <div class="hotel-image">
                <img src="${h.image}" alt="${h.name}">
            </div>
            <strong>${h.name}</strong><br><br>
            <b>Municipio:</b> ${h.city}<br>
            <b>Categoría:</b> ${starsHTML(h.stars)}<br>
            <b>Coordenadas:</b><br>
            ${h.lat.toFixed(4)}, ${h.lng.toFixed(4)}
        `;
    }

    search.addEventListener('input', () => {
        const v = normalize(search.value);
        render(hotels.filter(h =>
            normalize(h.name).includes(v) ||
            normalize(h.city).includes(v)
        ));
    });

    render(hotels);
</script>

</body>
</html>
